# 故事转视频 (Story to Video)

把一段文字故事自动拆成多个分镜，再为每个分镜生成图片与短视频，最终可连续播放或导出为一条完整视频。

---

## 功能概览

- **注册 / 登录**：基于 Supabase 认证
- **创建项目**：输入标题、故事内容、视觉风格（如写实、动漫、电影感等）
- **分镜**：将故事拆成 4～8 个可画面化的场景描述（支持 AI 或内置拆分）
- **图片**：按分镜描述生成或搜索图片（火山引擎 Seedream / Unsplash / 占位图）
- **视频**：按分镜图片与描述生成短视频（火山 Seedance / 或示例视频）
- **完成页**：连续播放各分镜、或导出为一条总视频（需服务器安装 ffmpeg）

---

## 技术栈

| 类别     | 技术 |
|----------|------|
| 前端/后端 | Next.js 16 (App Router) |
| 认证/数据库/存储 | Supabase |
| 故事→分镜 | OpenAI 兼容 API（可选；未配置时用内置 Mock） |
| 图片     | 火山引擎 Seedream（可选）/ Unsplash / Picsum |
| 视频     | 火山引擎 Seedance（可选）/ 免费示例视频 |

---

## 快速开始

### 1. 克隆并安装依赖

```bash
# 若你克隆的是整个仓库，进入网站目录
cd story-to-video-app

npm install
```

### 2. 配置环境变量

```bash
cp .env.local.example .env.local
```

用编辑器打开 `.env.local`，**至少配置 Supabase**（否则无法登录与保存数据）：

| 变量 | 说明 |
|------|------|
| `NEXT_PUBLIC_SUPABASE_URL` | Supabase 项目 URL（Project Settings → API） |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | Supabase anon 公钥（同上） |

其余为可选，见下方「可选配置」。

### 3. 初始化数据库

1. 在 [Supabase](https://supabase.com) 创建项目。
2. 在 **SQL Editor** 中依次执行本仓库**根目录**下 `supabase/migrations/` 中的 SQL 文件：
   - `001_initial_schema.sql`
   - `002_add_final_video.sql`
3. 在 **Authentication → Providers** 中启用 **Email**（可关闭邮件确认以便本地测试）。

### 4. 启动开发服务器

```bash
npm run dev
```

浏览器访问 **http://localhost:3000**。

若 3000 端口被占用，终端会提示使用其他端口（如 http://localhost:3001），以终端显示为准。

---

## 如何使用本网站

1. **注册 / 登录**  
   使用邮箱注册账号并登录。

2. **创建项目**  
   点击「创建项目」，填写标题、故事内容（可一段话或分句），选择风格（如写实、动漫、电影感等）。

3. **生成分镜**  
   在项目详情页点击「生成分镜」。系统会把故事拆成 4～8 个场景描述，可逐条确认或修改。

4. **确认全部分镜**  
   确认无误后点击「确认全部分镜」，进入图片阶段。

5. **生成图片**  
   点击「生成所有图片」。每个分镜会得到一张图（若配置了火山/Unsplash 则与描述相关，否则为占位图）。可单独重新生成或确认全部。

6. **确认全部图片**  
   确认后进入视频阶段。

7. **生成视频**  
   点击「生成所有视频」。每个分镜会生成一段短视频（若配置了火山 Seedance 则与图片和描述相关，否则为示例视频）。生成为异步，页面会显示「生成中…」并自动轮询。

8. **确认全部视频**  
   确认后项目进入「已完成」。

9. **完成页**  
   - **连续播放**：一个播放器按分镜顺序自动播完各段。  
   - **总视频**：点击「生成总视频」可将所有分镜拼接成一条视频（需服务器安装 ffmpeg）；若未安装会提示，不影响「连续播放」。  
   - 下方为分镜列表，可单独播放每一段。

---

## 可选配置

在 `.env.local` 中按需添加，详见同目录下的 **接入说明.md**。

| 变量 | 作用 |
|------|------|
| `OPENAI_API_KEY` + `OPENAI_BASE_URL` | 故事→分镜使用 AI 拆分与扩充（未配置则用内置拆分） |
| `VOLC_API_KEY` | 火山引擎：Seedream 文生图、Seedance 图生视频（需在控制台开通对应模型） |
| `UNSPLASH_ACCESS_KEY` | 未用火山时，按描述关键词在 Unsplash 搜图 |

不配置上述变量时，分镜用内置逻辑拆分，图片为 Unsplash 或 Picsum，视频为示例视频，仍可走通全流程。

---

## 脚本说明

| 命令 | 说明 |
|------|------|
| `npm run dev` | 启动开发服务器（默认 http://localhost:3000） |
| `npm run build` | 生产环境构建 |
| `npm run start` | 运行生产构建（需先 `npm run build`） |
| `npm run lint` | 运行 ESLint |

---

## 文档

- **接入说明.md**：Supabase / OpenAI / 火山 / Unsplash 的配置步骤与示例。
- **火山引擎与模型配置说明.md**：火山 Seedream、Seedance 开通与回退逻辑说明。

---

## 环境要求

- Node.js 18+
- 若使用「生成总视频」功能，服务器需安装 **ffmpeg** 且可在命令行中执行。

---

## 许可证与免责

本项目仅供学习与演示。使用第三方 API（如 OpenAI、火山引擎、Unsplash）时请遵守其服务条款；密钥请勿提交到 Git 或公开仓库。
