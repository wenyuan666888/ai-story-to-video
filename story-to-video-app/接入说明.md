# 故事转视频 - 需要接入的接口说明（最终版）

本应用**需要你接入**的只有下面这些；按顺序配置好后即可得到完整可用版本。

---

## 一、必接：Supabase（认证 + 数据库 + 存储）

**用途**：用户注册/登录、项目与分镜数据、图片/视频存储。

**操作**：

1. 打开 https://supabase.com 登录 → **New project** 创建项目。
2. 在 **Project Settings → API** 中复制：
   - **Project URL** → 填到 `NEXT_PUBLIC_SUPABASE_URL`
   - **anon public** key（以 `eyJ` 开头）→ 填到 `NEXT_PUBLIC_SUPABASE_ANON_KEY`
3. 在 **SQL Editor** 中执行本仓库根目录 `supabase/migrations/001_initial_schema.sql`。
4. **Authentication → Providers** 中启用 **Email**（可暂时关闭 Confirm email 方便测试）。

**`.env.local` 示例**：

```env
NEXT_PUBLIC_SUPABASE_URL=https://你的项目.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJ...你的anon公钥
```

配置完成后重启 `npm run dev`，即可注册、登录、创建项目并走完整流程。

---

## 二、可选：OpenAI 兼容接口（故事→分镜 + 图片关键词）

**用途**：

- **故事 → 分镜**：把用户输入的故事拆成 4～8 个可画面化的分镜描述。
- **图片关键词**：将中文分镜描述转为英文关键词，用于 Unsplash 搜图，使图片与描述更相关。

**不配置时**：分镜使用内置 Mock（按故事内容简单拆分）；图片关键词用通用词，Unsplash 搜图效果会打折扣。

**操作**：

1. 准备任意 **OpenAI 兼容** 的 API（OpenAI、智谱、DeepSeek、通义、One API 等，只要支持 chat completions 即可）。
2. 在 `.env.local` 中增加：

```env
OPENAI_API_KEY=你的API密钥
OPENAI_BASE_URL=https://api.openai.com/v1
```

若非 OpenAI 官方，把 `OPENAI_BASE_URL` 改成该服务提供的 chat 接口地址。

保存后重启 `npm run dev`。

---

## 三、可选：火山引擎 Seedream（按描述文生图，推荐）

**用途**：按分镜描述 + 项目风格调用火山方舟 Seedream 文生图，生成的图片**与文本描述一致**。

**操作**：

1. 打开 https://console.volcengine.com/ark 登录火山方舟。
2. 在 **API Key 管理** 中创建 API Key，复制保存。
3. **开通模型**：在控制台 **开通管理 / 模型服务** 中开通并激活 **Seedream 4.5**（doubao-seedream-4-5-251128）图像生成模型，否则会报「has not activated the model」。
4. 在 `.env.local` 中增加：

```env
VOLC_API_KEY=你的API Key
```

配置后，「生成所有图片」会优先使用火山引擎按每个分镜描述生成图片并上传到 Supabase 存储。

**若未开通 Seedream 模型**：应用会自动退回到 Unsplash 或 Picsum，不影响继续生成。**不配置 VOLC_API_KEY 时**：会直接使用 Unsplash 搜索或 Picsum 占位图。

---

## 四、可选：Unsplash（无火山引擎时的备选）

**用途**：未配置 `VOLC_API_KEY` 时，按分镜描述关键词在 Unsplash 搜索图片。

**操作**：在 `.env.local` 中增加 `UNSPLASH_ACCESS_KEY=你的Access Key`（需在 https://unsplash.com/oauth/applications 申请）。若不配置则使用 Picsum 占位图。

---

## 五、视频（与分镜图片、描述相关）

**已配置 VOLC_API_KEY 且已开通 Seedance 模型时**：使用火山方舟 **Seedance 图生视频**，按每个分镜的**图片 + 描述**生成与内容相关的短视频（异步任务，约 1～3 分钟，页面会自动轮询完成）。

**未配置或未开通 Seedance 时**：使用多段免费示例视频按分镜顺序分配，与描述无关。

**开通方式**：在 [火山方舟控制台](https://console.volcengine.com/ark) 的 **开通管理 / 模型服务** 中开通并激活 **Seedance** 图生视频模型（与 Seedream 图片为不同模型，需分别开通）。未开通时会自动退回到示例视频。

---

## 六、.env.local 最终示例（复制即用，按需取消注释）

```env
# ========== 必填 ==========
NEXT_PUBLIC_SUPABASE_URL=https://你的项目.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJ...你的anon公钥

# ========== 可选：故事→分镜 + 图片关键词 ==========
# OPENAI_API_KEY=你的key
# OPENAI_BASE_URL=https://api.openai.com/v1

# ========== 可选：图片按描述文生图（推荐）==========
# VOLC_API_KEY=你的火山方舟API Key

# ========== 可选：无火山时按描述搜图 ==========
# UNSPLASH_ACCESS_KEY=你的Unsplash Access Key
```

---

## 小结

| 接口           | 必填/可选 | 作用                         |
|----------------|-----------|------------------------------|
| Supabase       | **必填**  | 登录、数据库、存储           |
| OpenAI 兼容    | 可选      | 故事→分镜、描述→图片关键词   |
| 火山引擎       | 可选      | 图片：Seedream 文生图；视频：Seedance 图生视频（与描述一致）|
| Unsplash       | 可选      | 无火山时按描述搜索图片       |
| 视频（无火山） | 自动      | 免费示例视频                 |

按上述接入后，应用即为**最终可用版本**：注册 → 登录 → 创建项目 → 生成分镜 → 确认 → 生成图片（与描述一致）→ 确认 → 生成视频（开通 Seedance 后与分镜图片、描述一致）→ 确认 → 完成。
